import{j as e,T as n,B as p,am as d,y,P as w,a7 as j}from"./index-Bg98_QeE.js";import{A as v}from"./alert-L1MVTzbb.js";import{E as N}from"./empty-list-CRPc_biP.js";import{T as k}from"./tag-BRMko7Vz.js";import{u}from"./useQuery-BdJPzJxX.js";import{u as b,c as _,P as S,g as R}from"./paginated-table-CwZSG0iA.js";import"./side-panel-provider-CijlBVW-.js";import{M as g}from"./main-caSoDvOd.js";import{P as A,a as P}from"./preview_list-b9qBPjsx.js";import"./useBaseQuery-6gRlBW00.js";import"./Table-CxfAVGCA.js";import"./useToggleState-BwA-CvQv.js";import"./select-DCJPqsy0.js";const C="/assets/preview_error-C8aVnTl9.svg",T="/assets/preview_notification-CAba5nmY.svg",z="/assets/preview_error-63_jv1Kp.svg",I="/assets/preview_notification-htPxRhTs.svg",E=[{title:"Monitor Your Kloset Store",description:"We only collect non-sensitive metadata. Your backup contents are never sent to us.",src:P,darkSrc:A},{title:"Alerts",description:"Get error notifications so you can keep your backups secure.",src:z,darkSrc:C},{title:"Weekly Summaries",description:"Receive a concise activity summary in your inbox.",src:I,darkSrc:T}];function L(){return e.jsx(g,{className:"h-full",children:e.jsxs("div",{className:"m-auto flex h-full w-full flex-col items-center justify-center",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(n,{variant:"heading",size:"xl",weight:"medium",className:"text-primary",children:"Alerting"}),e.jsx(n,{size:"md",className:"text-secondary",children:"Log in to plakar.io to access the alerting features. Get reports and notifications about your Kloset store activity. For free."})]}),e.jsx("div",{className:"mb-16 mt-8 w-full overflow-auto text-center",children:e.jsx("ol",{"aria-label":"Authenticated features",className:"inline-flex list-none gap-4",children:E.map((s,r)=>e.jsx(F,{...s},r))})}),e.jsx(p,{href:{to:"/login",search:{returnUrl:"/alerting"}},className:"w-full max-w-sm",children:"Sign in"})]})})}function F({title:s,description:r,src:l,darkSrc:a}){return e.jsxs("li",{className:"border-primary bg-primary w-70 flex max-w-sm flex-col items-center gap-1 rounded-2xl border p-2",children:[e.jsx("img",{src:l,alt:s,loading:"lazy",className:"w-66 block h-40 max-w-none dark:hidden"}),e.jsx("img",{src:a,alt:s,loading:"lazy",className:"w-66 hidden h-40 max-w-none dark:block"}),e.jsxs("div",{className:"flex flex-col items-center py-2",children:[e.jsx(n,{size:"md",className:"text-secondary",weight:"medium",children:s}),e.jsx(n,{size:"sm",className:"text-tertiary",children:r})]})]})}function X(){const s=d.useNavigate(),r=d.useSearch(),l=d.useLoaderData().item,a=u(j());return a.data?.__type==="unauthenticated"?e.jsx(L,{}):e.jsx(g,{title:"Alerting",description:"Follow the activity of your Kloset store.",children:e.jsx("div",{className:"flex flex-col gap-4",children:a.isPending?e.jsx(y,{}):a.isError?e.jsx(N,{illustrationType:"sad",title:"Unable to load alerting configuration",description:a.error.message,actions:[{children:"Retry",onPress:()=>a.refetch(),variant:"secondary"}]}):a.data.__type==="ok"&&e.jsxs(e.Fragment,{children:[!a.data.configuration.enabled&&e.jsx(v,{title:"Alerting is disabled",variant:"warning",actions:[e.jsx(p,{variant:"secondary",href:{to:"/settings"},children:"Go to settings"},"settings-button")],children:"The alerting service is currently disabled. You can enable it in the settings."}),e.jsx(K,{repository:l.configuration.repository_id.Value,page:r.page,perPage:r.per_page,onPageChange:(c,o)=>s({search:m=>({...m,page:m.per_page!==o?0:c,per_page:o})})})]})})})}function K({repository:s,page:r,perPage:l,onPageChange:a}){const c=u({...w({repository:s,page:r,perPage:l}),select:t=>{if(t.__type==="unauthenticated")throw new Error("You should be authenticated to list reports");return t}}),o=_(),m={pageIndex:r,pageSize:l},x=b({data:c.isSuccess&&c.data.__type==="ok"?c.data.items:[],columns:[o.display({id:"status",meta:{cellClassName:"md:w-[20%]"},header:()=>"Status",cell:t=>{const i=t.row.original,h={OK:"success-circle",WARNING:"warning-triangle",FAILURE:"error-circle",unknown:"info-circle"}[i.report_task.status],f={OK:"green",WARNING:"yellow",FAILURE:"red",unknown:"transparent"}[i.report_task.status];return e.jsxs("span",{className:"flex flex-col items-start gap-2",children:[e.jsx(k,{leftIcon:h,variant:f,radius:"sqrt",className:"capitalize",children:t.row.original.report_task.type.HumanString}),e.jsx(n,{as:"span",className:"text-secondary",size:"xs",children:t.row.original.report_task.duration.toHumanString()?e.jsxs(e.Fragment,{children:["Completed in"," ",t.row.original.report_task.duration.toHumanString()]}):e.jsx(e.Fragment,{children:"Completed almost instantly"})})]})}}),o.accessor("report_task.name",{meta:{cellClassName:"md:w-[20%]"},header:()=>"Name",cell:t=>{const i=t.getValue();return e.jsx(n,{as:"span",className:"text-primary",children:i==="@agent"||i==="@agentless"?"":i})}}),o.display({meta:{cellClassName:"md:w-[20%]"},id:"timeline",header:()=>"Timeline",cell:t=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(n,{as:"span",className:"text-primary whitespace-nowrap",children:t.row.original.timestamp.relativeToNow()}),e.jsx(n,{as:"span",className:"text-secondary",size:"sm",children:t.row.original.timestamp.toHumanString()})]})})}),o.display({id:"output",header:()=>"Output",cell:t=>e.jsx(e.Fragment,{children:t.row.original.report_task.status!=="OK"&&e.jsx(n,{as:"span",className:"text-primary",children:t.row.original.report_task.error_message})})})],state:{pagination:m},enableRowSelection:!1,enableMultiRowSelection:!1,getRowId:t=>t.id,manualPagination:!0,onPaginationChange:t=>{const i=typeof t=="function"?t(m):t;a(i.pageIndex,i.pageSize)},getCoreRowModel:R()});return e.jsx(S,{query:c,table:x,ariaLabel:"Reports table",variant:"cards",skeleton:"two-rows"})}export{X as component};
